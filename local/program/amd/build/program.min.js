/**
 * Add a create new group modal to the page.
 *
 * @module     local/Program
 * @class      Program
 * @package
 * @copyright  2022 eAbyas Info Solutions
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_program/program",["local_program/jquery.dataTables","core/str","core/modal_factory","core/modal_events","core/ajax","jquery","jqueryui","core/notification"],(function(dataTable,Str,ModalFactory,ModalEvents,Ajax,$,Notification){return{init:function(args){this.AssignUsers(args)},programDatatable:function(args){var params=[];params.action="viewprograms",params.programstatus=args.programstatus,Str.get_string("search","local_program").then((function(s){$("#viewprograms").dataTable({processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php?subdepts="+args.selected_subdepts+"&costcenterid="+args.selectedcostcenterid+"&departmentid="+args.selecteddepartmentid+"&program="+args.selectedprogram+"&status="+args.selectedstatus+"&groups="+args.selectedgroups,data:params},bInfo:!1,bLengthChange:!1,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>"},oLanguage:{sSearch:s,sZeroRecords:"No Programs Available"},pageLength:6})}))},SessionDatatable:function(args){var params=[];params.action="viewprogramsessions",params.programid=args.programid,params.levelid=args.levelid,params.bclcid=args.bclcid,""!=args.action?params.tab=args.action:params.tab=!1,$("#viewprogramsessions").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1}),this.sessionenrol(args)},sessionenrol:function(args){$(document).on("click",".sessionenrol",(function(){var sessionargs=$(this).data();return Str.get_strings([{key:"confirmation",component:"local_program"},{key:"confirmschedulesession",component:"local_program"},{key:"confirmreschedulesession",component:"local_program"},{key:"confirmcancelsession",component:"local_program"},{key:"yes"}]).then(function(s){var body=s[1];2==sessionargs.enrol?body=s[2]:3==sessionargs.enrol&&(body=s[3]),ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:body}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[4]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_session_enrolments",args:sessionargs}])[0].done((function(){window.location.href=window.location.href+String()})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))}))},CoursesDatatable:function(){var params=[];params.action="viewprogramcourses",params.programid=$("#viewprogramcourses").data("programid"),$("#viewprogramcourses").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},UsersDatatable:function(){var params=[];params.action="viewprogramusers",params.programid=$("#viewprogramusers").data("programid"),$("#viewprogramusers").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search",sZeroRecords:"No Students Available"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},GroupsDatatable:function(){var params=[];params.action="viewgroupusers",params.programid=$("#viewgroupusers").data("programid"),$("#viewgroupusers").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},GroupsDatatables:function(){var params=[];params.action="viewgroupusersdata",params.cohortid=$("#viewgroupusersdata").data("groupid"),$("#viewgroupusersdata").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},deleteConfirm:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:"no"},{key:"deleteallconfirm",component:"local_program"},{key:"delete"},{key:"deletecourseconfirm",component:"local_program"},{key:"cannotdeleteall",component:"local_program"},{key:"cannotdeletesession",component:"local_program"},{key:"cannotdeletelevel",component:"local_program"},{key:"inactiveconfirm",component:"local_program",param:args.programname},{key:"activeconfirm",component:"local_program",param:args.programname},{key:"deleteconfirm",component:"local_program",param:args.programname}]).then(function(s){if("deleteprogram"==args.action){s[1]=s[10];var confirm=ModalFactory.types.SAVE_CANCEL}else if("deleteprogramcourse"==args.action){s[1]=s[4];confirm=ModalFactory.types.SAVE_CANCEL}else if("cannotdeleteprogram"==args.action){s[1]=s[5];confirm=ModalFactory.types.DEFAULT}else if("cannotdeletesession"==args.action){s[1]=s[6];confirm=ModalFactory.types.DEFAULT}else if("cannotdeletelevel"==args.action){s[1]=s[7];confirm=ModalFactory.types.DEFAULT}else if("inactiveprogram"==args.action){s[1]=s[8];confirm=ModalFactory.types.SAVE_CANCEL}else if("activeprogram"==args.action){s[1]=s[9];confirm=ModalFactory.types.SAVE_CANCEL}else{s[1]=s[2];confirm=ModalFactory.types.SAVE_CANCEL}ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,"cannotdeleteprogram"!=args.action&&"cannotdeletesession"!=args.action&&"cannotdeletelevel"!=args.action&&modal.setSaveButtonText(s[3]),"cannotdeletelevel"===args.action&&$(document).on("click","#page-local-program-view .modal-header .close",(function(){modal.destroy()})),"deletelevel"===args.action&&($(document).on("click","#page-local-program-view .modal-footer .btn-secondary",(function(){modal.destroy()})),$(document).on("click","#page-local-program-view .modal-header .close",(function(){modal.destroy()}))),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_"+args.action,args:args}])[0].done((function(){"deletestream"==args.action?window.location.href=M.cfg.wwwroot+"/local/program/streams.php":"deletesession"==args.action||"deleteprogram"==args.action||"activeprogram"==args.action||"inactiveprogram"==args.action?window.location.href=window.location.href+String():window.location.href=M.cfg.wwwroot+"/local/program/view.php?bcid="+args.programid})).fail((function(){console.log(args)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},AssignUsers:function(){$(".usersselect").click((function(){var type=$(this).data("id");"removeselect"===type?($("input#remove").prop("disabled",!1),$("input#add").prop("disabled",!0)):"addselect"===type&&($("input#remove").prop("disabled",!0),$("input#add").prop("disabled",!1)),$(this).hasClass("select_all")?$("#"+type+" option").prop("selected",!0):$(this).hasClass("remove_all")&&$("#"+type).val("").trigger("change")}))},programStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:args.actionstatusmsg,component:"local_program"},{key:"yes"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_"+args.action,args:args}])[0].done((function(){window.location.href=window.location.href+String()})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},ManageprogramStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:args.actionstatusmsg,component:"local_program",param:args.programname},{key:"deleteallconfirm",component:"local_program"},{key:"yes"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_manageprogramStatus",args:args}])[0].done((function(){window.location.href=M.cfg.wwwroot+"/local/program/view.php?bcid="+args.programid})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},load:function(){$(document).on("click","#id_institute_type_1, #id_institute_type_2",(function(){$("#fitem_id_instituteid .form-autocomplete-selection .badge.badge-info").trigger("click"),$("#fitem_id_roomid .form-autocomplete-selection .badge.badge-info").trigger("click")}))},unassignCourses:function(args){return Str.get_strings([{key:"confirm"},{key:"yes"},{key:"unassign",component:"local_program"},{key:"cannotunassign_courses_confirm",component:"local_program"},{key:"unassign_courses_confirm",component:"local_program",param:args}]).then(function(s){if("unassign_course"==args.action){s[1]=s[4];var confirm=ModalFactory.types.SAVE_CANCEL}else if("cannotunassign_course"==args.action){s[1]=s[3];confirm=ModalFactory.types.DEFAULT}else{s[1]=s[4];confirm=ModalFactory.types.SAVE_CANCEL}ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,"cannotunassign_course"!=args.action&&modal.setSaveButtonText(s[2]),"cannotunassign_course"===args.action&&$(document).on("click","#page-local-program-view .modal-header .close",(function(){modal.destroy()})),"unassign_course"===args.action&&($(document).on("click","#page-local-program-view .modal-content .modal-footer .btn-secondary",(function(){modal.destroy()})),$(document).on("click","#page-local-program-view .modal-content .modal-header .close",(function(){modal.destroy()}))),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault();var params={};params.programid=args.bcid,params.levelid=args.levelid,params.bclcid=args.bclcid,Ajax.call([{methodname:"local_program_"+args.action,args:params}])[0].done((function(){modal.destroy(),"unassign_course"===args.action&&$.ajax({method:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:{action:"programlevelcourses",programid:args.bcid,levelid:args.levelid},success:function(resp){$(".levetabscontent_container").html(resp)}})})).fail((function(){}))}.bind(this)),modal.show()}.bind(this)),this.modal.show()}.bind(this))},enroluser:function(args){return Str.get_strings([{key:"course_enrolment",component:"local_program"},{key:"course_enrolment_confirm",component:"local_program",param:args.coursename},{key:"yes"},{key:"no"}]).then(function(s){if("enrol"==args.action)var confirm=ModalFactory.types.SAVE_CANCEL;ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault();var params={};params.programid=args.programid,params.userid=args.userid,params.courseid=args.courseid,params.levelid=args.levelid,Ajax.call([{methodname:"local_program_assign_course",args:params}])[0].done((function(){window.location.href=window.location.href+"?bcid="+args.programid})).fail((function(exception){}))}.bind(this)),modal.show()}.bind(this)),this.modal.show()}.bind(this))},StreamsDatatable:function(){var params=[];params.action="viewprogramstreams",Str.get_string("search","local_program").then((function(s){$("#viewprogramstreams").dataTable({processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},bInfo:!1,bLengthChange:!1,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>"},oLanguage:{sSearch:s},pageLength:6})}))},getstream:function(){$(document).on("change","#id_costcenter",(function(){var orgID=$(this).val();if(!orgID)return Str.get_strings([{key:"selectstrem",component:"local_program"}]).then((function(strings){"<option value=''>"+strings[0]+"</option>"}));Ajax.call([{methodname:"local_program_streams",args:{orgid:orgID}}])[0].done((function(resp){return Str.get_strings([{key:"selectstrem",component:"local_program"}]).then((function(strings){"<option value=null>"+strings[0]+"</option>"}))})).fail((function(){alert("Error occured while processing request"),window.location.reload()}))}))},unEnrolUser:function(args){return Str.get_strings([{key:"confirm"},{key:"program_self_unenrolment",component:"local_program",param:args.programname}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[0]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault();var params={};params.userid=args.userid,params.programid=args.programid,params.contextid=args.contextid,Ajax.call([{methodname:"local_program_unenrol_user",args:params}])[0].done((function(){window.location.href=M.cfg.wwwroot})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))}}}));

//# sourceMappingURL=program.min.js.map