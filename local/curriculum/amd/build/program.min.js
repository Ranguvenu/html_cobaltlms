/**
 * Add a create new group modal to the page.
 *
 * @module     core_group/AjaxForms
 * @class      AjaxForms
 * @package
 * @copyright  2022 Eabyas Info Solutions <www.eabyas.in>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_curriculum/program",["core/str","core/modal_factory","core/modal_events","core/ajax","jquery","jqueryui"],(function(Str,ModalFactory,ModalEvents,Ajax,$){return{init:function(args){this.AssignUsers(args)},curriculumDatatable:function(args){var params=[];params.action="viewcurriculums",params.curriculumstatus=args.curriculumstatus,$("#viewcurriculums").dataTable({bInfo:!1,processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},bLengthChange:!1,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>"},pageLength:6})},SessionDatatable:function(args){var params=[];params.action="viewcurriculumsessions",params.curriculumid=args.curriculumid,params.semesterid=args.semesterid,params.bclcid=args.bclcid,""!=args.action?params.tab=args.action:params.tab=!1,$("#viewcurriculumsessions").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1}),this.sessionenrol(args)},deleteConfirm:function(args){return Str.get_strings([{key:"confirmation",component:"local_curriculum"},{key:"deleteconfirm",component:"local_curriculum",param:args.curriculumname},{key:"deleteallconfirm",component:"local_curriculum"},{key:"Delete"},{key:"deletecourseconfirm",component:"local_curriculum"},{key:"cannotdeleteall",component:"local_curriculum"},{key:"cannotdeletesession",component:"local_curriculum"},{key:"cannotdeletesemester",component:"local_curriculum"},{key:"cannotdeletesemesteryear",component:"local_curriculum"},{key:"confirmunassignfaculty",component:"local_curriculum"}]).then(function(s){if("deletecurriculum"==args.action){s[1]=s[3];var confirm=ModalFactory.types.CONFIRM}else if("deletecurriculumcourse"==args.action){s[1]=s[4];confirm=ModalFactory.types.CONFIRM}else if("cannotdeletecurriculum"==args.action){s[1]=s[5];confirm=ModalFactory.types.DEFAULT}else if("cannotdeletesession"==args.action){s[1]=s[6];confirm=ModalFactory.types.DEFAULT}else if("cannotdeletesemester"==args.action){s[1]=s[7];confirm=ModalFactory.types.DEFAULT}else if("cannotdeletesemesteryear"==args.action){s[1]=s[8];confirm=ModalFactory.types.DEFAULT}else if("unassignfaculty"==args.action){s[1]=s[9];confirm=ModalFactory.types.CONFIRM}else{s[1]=s[2];confirm=ModalFactory.types.CONFIRM}ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,"cannotdeletecurriculum"!=args.action&&"cannotdeletesession"!=args.action&&"cannotdeletesemester"!=args.action&&"cannotdeletesemesteryear"!=args.action&&modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.yes,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_curriculum_"+args.action,args:args}])[0].done((function(){"deleteprogram"==args.action?window.location.href=M.cfg.wwwroot+"/local/curriculum/index.php":window.location.href=M.cfg.wwwroot+"/local/curriculum/view.php?ccid="+args.curriculumid})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},AssignUsers:function(){$(".usersselect").click((function(){var type=$(this).data("id");"removeselect"===type?($("input#remove").prop("disabled",!1),$("input#add").prop("disabled",!0)):"addselect"===type&&($("input#remove").prop("disabled",!0),$("input#add").prop("disabled",!1)),$(this).hasClass("select_all")?$("#"+type+" option").prop("selected",!0):$(this).hasClass("remove_all")&&$("#"+type).val("").trigger("change")}))},curriculumStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:args.actionstatusmsg,component:"local_program"},{key:"Confirm"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.CONFIRM,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.yes,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_curriculum_"+args.action,args:args}])[0].done((function(){window.location.href=window.location.href+String()})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},ManagecurriculumStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:args.actionstatusmsg,component:"local_program",param:args.curriculumname},{key:"deleteallconfirm",component:"local_program"},{key:"yes"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.CONFIRM,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.yes,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_managecurriculumStatus",args:args}])[0].done((function(){window.location.href=M.cfg.wwwroot+"/local/curriculum/view.php?ccid="+args.curriculumid})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},load:function(){},unassignCourses:function(args){return Str.get_strings([{key:"confirm"},{key:"unassign_courses_confirm",component:"local_program",param:args},{key:"unassign",component:"local_program"},{key:"cannotunassign_courses_confirm",component:"local_program"}]).then(function(s){if("unassign_course"==args.action){s[1]=s[2];var confirm=ModalFactory.types.CONFIRM}else if("cannotunassign_course"==args.action){s[1]=s[3];confirm=ModalFactory.types.DEFAULT}else{s[1]=s[0];confirm=ModalFactory.types.CONFIRM}ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,"cannotunassign_course"!=args.action&&modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.yes,function(e){e.preventDefault();var params={};params.programid=args.programid,params.curriculumid=args.curriculumid,params.semesterid=args.semesterid,params.yearid=args.yearid,params.courseid=args.courseid,Ajax.call([{methodname:"local_program_"+args.action,args:params}])[0].done((function(){window.location.href=window.location.href+String()})).fail((function(){}))}.bind(this)),modal.show()}.bind(this)),modal.show()}.bind(this))},ProgramsDatatable:function(args){var params=[];params.action="viewcurriculumprograms",params.type=args.type,params.options=args.options;var rows_selected=[],table=$("#viewcurriculumprograms").DataTable({processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>"},order:[[1,"asc"]],rowCallback:function(row,data){var rowId=data[0];-1!==$.inArray(rowId,rows_selected)&&1==args.type&&($(row).find('input[type="checkbox"]').prop("checked",!0),$(row).addClass("selected"))},pageLength:10});1==args.type&&($("#viewcurriculumprograms tbody").on("click",".programcheckbox",(function(e){var $row=$(this).closest("tr"),rowId=table.row($row).data()[0],index=$.inArray(rowId,rows_selected);this.checked&&-1===index?rows_selected.push(rowId):this.checked||-1===index||rows_selected.splice(index,1),this.checked?$row.addClass("selected"):$row.removeClass("selected"),undefined.updateDataTableSelectAllCtrl(table),e.stopPropagation()})),$("#viewcurriculumprograms").on("click","tbody td .programcheckbox, thead th .programcheckboxhead",(function(){$(this).parent().find('input[type="checkbox"]').trigger("click")})),$('thead input[name="select_all"]',table.table().container()).on("click",(function(e){this.checked?$('#viewcurriculumprograms tbody input[type="checkbox"]:not(:checked)').trigger("click"):$('#viewcurriculumprograms tbody input[type="checkbox"]:checked').trigger("click"),e.stopPropagation()})),table.on("draw",(function(){undefined.updateDataTableSelectAllCtrl(table)})))},updateDataTableSelectAllCtrl:function(table){var $table=table.table().node(),$chkbox_all=$('tbody input[type="checkbox"]',$table),$chkbox_checked=$('tbody input[type="checkbox"]:checked',$table),chkbox_select_all=$('thead input[name="select_all"]',$table).get(0);0===$chkbox_checked.length?(chkbox_select_all.checked=!1,"indeterminate"in chkbox_select_all&&(chkbox_select_all.indeterminate=!1)):$chkbox_checked.length===$chkbox_all.length?(chkbox_select_all.checked=!0,"indeterminate"in chkbox_select_all&&(chkbox_select_all.indeterminate=!1)):(chkbox_select_all.checked=!0,"indeterminate"in chkbox_select_all&&(chkbox_select_all.indeterminate=!0))},FacultysDatatable:function(){var params=[];params.action="viewcoursefaculty",params.yearid=$("#viewcoursefaculty").data("yearid"),params.semesterid=$("#viewcoursefaculty").data("semesterid"),params.courseid=$("#viewcoursefaculty").data("courseid"),$("#viewcoursefaculty").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/curriculum/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},masterprogramchildpopup:function(args){$.ajax({type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:{curriculumid:args.id,action:"masterprogramchildpopup",sesskey:M.cfg.sesskey},success:function(returndata){ModalFactory.create({title:args.title,body:returndata}).done((function(modal){modal.show(),undefined.chlidprogramsDatatable(args),modal.setLarge(),modal.getRoot().addClass("openLMStransition"),modal.getRoot().animate({right:"0%"},500),modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}.bind(this)),$(".close").click((function(){modal.hide(),modal.destroy()}))}))}})},chlidprogramsDatatable:function(args){var params=[];params.action="masterprogramchildpopup",params.curriculumid=args.id,params.stable=0,$("#chlidprograms").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},checkProgramStatus:function(args){$.ajax({type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:{programid:args.pid,curriculumid:args.ccid,costcenter:args.costcenter,action:"programstatusvalidation",sesskey:M.cfg.sesskey},success:function(returndata){"true"==returndata.finalstatus?ModalFactory.create({title:"Confirm",type:ModalFactory.types.SAVE_CANCEL,body:Str.get_string("publishprogramconfirmationmessage","local_program",args.programname)}).done(function(modal){this.modal=modal,modal.setSaveButtonText("Confirm"),modal.getRoot().on(ModalEvents.yes,function(e){modal.hide(),modal.destroy(),e.preventDefault(),args.confirm=!0,$.ajax({type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:{programid:args.pid,curriculumid:args.ccid,costcenter:args.costcenter,action:"publishprogram",sesskey:M.cfg.sesskey},success:function(response){ModalFactory.create({title:"Success!",body:response}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.hidden,function(){setTimeout((function(){modal.destroy()}),4e3)}.bind(this)),$(".close").click((function(){modal.hide(),modal.destroy()})),document.location.reload()}))}})}.bind(this)),modal.show()}.bind(this)):ModalFactory.create({type:ModalFactory.types.CANCEL,title:"Alert!",body:returndata.message}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}.bind(this)),$(".close").click((function(){modal.hide(),modal.destroy()}))}))}})}}}));

//# sourceMappingURL=program.min.js.map