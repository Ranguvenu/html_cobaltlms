{"version":3,"file":"courseAjaxform.min.js","sources":["../src/courseAjaxform.js"],"sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     local_courses/courseAjaxform\n * @class      courseAjaxform\n * @package\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['local_courses/jquery.dataTables', 'jquery', 'core/str',\n 'core/modal_factory', 'core/modal_events', 'core/fragment', 'core/ajax',\n  'core/yui', 'core/templates'],\n        function(dataTable, $, Str, ModalFactory, ModalEvents, Fragment, Ajax, Y, Templates) {\n\n    /**\n     * Constructor\n     *\n     * @param {object} args\n     *\n     * Each call to init gets it's own instance of this class.\n     */\n    var courseAjaxform = function(args) {\n        this.contextid = args.contextid || 1;\n        this.args = args;\n        this.init(args);\n    };\n\n    /**\n     * @var {Modal} modal\n     * @private\n     */\n    courseAjaxform.prototype.modal = null;\n\n    /**\n     * @var {int} contextid\n     * @private\n     */\n    courseAjaxform.prototype.contextid = -1;\n\n    /**\n     * Initialise the class.\n     * @param {object} args\n     * @private\n     * @return {Promise}\n     */\n    courseAjaxform.prototype.init = function(args) {\n        // Fetch the title string.\n        var self = this;\n         if (args.courseid) {\n            if (args.callback==='custom_selfcompletion_form') {\n                var head =  {key: 'selfcompletionname',component: 'local_courses',param: args.coursename};\n            }else{\n                if (args.userid) {\n                    var head =  {key:'browseevidencesname', component:'local_courses',param: args.coursename};\n                }else{\n                    var head =  {key:'editcourse', component:'local_courses'};\n                }\n            }\n        }else{\n           var head = {key:'createnewcourse', component:'local_courses'};\n        }\n            var customstrings;\n            customstrings = Str.get_strings([head, {\n                key: 'yes',\n                component: 'customfield'\n            },\n            {\n                key: 'no',\n                component: 'customfield'\n            },\n            {\n                key: 'saveandcontinue',\n                component: 'local_courses'\n            },\n            {\n                key: 'cancel',\n                component: 'moodle'\n            }]);\n        return customstrings.then(function(strings) {\n            // Create the modal.\n            return ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                title: strings[0],\n                body: this.getBody(),\n                footer: this.getFooter(strings),\n            });\n        }.bind(this)).then(function(modal) {\n            // Keep a reference to the modal.\n            this.modal = modal;\n            if (args.callback !='custom_selfcompletion_form') {\n                // Forms are big, we want a big modal.\n                this.modal.setLarge();\n\n                this.modal.getRoot().addClass('openLMStransition local_courses');\n                // We want to reset the form every time it is opened.\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 1000);\n                    this.modal.setBody('');\n                }.bind(this));\n            }\n\n            // We catch the modal save event, and use it to submit the form inside the modal.\n            // Triggering a form submission will give JS validation scripts a chance to check for errors.\n            // this.modal.getRoot().on(ModalEvents.save, this.submitForm.bind(this));\n\n            if (args.callback =='custom_selfcompletion_form') {\n                this.modal.getFooter().find('[data-action=\"save\"]').on('click', function() {\n                    window.location.href = M.cfg.wwwroot\n                    + '/course/togglecompletion.php?confirm=1&course='\n                    +args.courseid+'&sesskey='+M.cfg.sesskey;\n                });\n\n                this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                    window.location.reload();\n                });\n\n                this.modal.getRoot().find('[data-action=\"hide\"]').on('click', function() {\n                    window.location.reload();\n                });\n            }else{\n                this.modal.footer.find('[data-action=\"save\"]').on('click', this.submitForm.bind(this));\n                // We also catch the form submit event and use it to submit the form with ajax.\n                this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                    modal.setBody('');\n                    modal.hide();\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 1000);\n                    if (args.form_status !== 0 ) {\n                        window.location.reload();\n                    }\n                });\n\n                this.modal.getRoot().find('[data-action=\"hide\"]').on('click', function() {\n                    modal.hide();\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 1000);\n                    if (args.form_status !== 0 ) {\n                        window.location.reload();\n                    }\n                });\n            }\n\n            this.modal.getRoot().on('submit', 'form', function(form) {\n                self.submitFormAjax(form, self.args);\n            });\n            this.modal.show();\n            this.modal.getRoot().animate({\"right\":\"0%\"}, 500);\n            return this.modal;\n        }.bind(this));\n    };\n\n    /**\n     * @param {object} formdata\n     * @method getBody\n     * @private\n     * @return {Promise}\n     */\n    courseAjaxform.prototype.getBody = function(formdata) {\n        if (typeof formdata === \"undefined\") {\n            formdata = {};\n        }\n        // Get the content of the modal.\n        this.args.jsonformdata = JSON.stringify(formdata);\n        return Fragment.loadFragment(this.args.component, this.args.callback, this.contextid, this.args);\n    };\n    /**\n     * @param {object} customstrings\n     * @method getFooter\n     * @private\n     * @return {Promise}\n     */\n    courseAjaxform.prototype.getFooter = function(customstrings) {\n                var footer = '';\n                if (this.args.callback==='custom_selfcompletion_form') {\n                    footer += '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'\n                    +customstrings[1]+'</button>&nbsp;';\n                    footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+customstrings[2]+'</button>';\n                }\n                else if(this.args.viewtype!='userview'){\n                    footer+= '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+customstrings[3]+'</button>&nbsp;';\n                    footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+customstrings[4]+'</button>';\n                }\n            return footer;\n    };\n     /**\n     * @method getFooter\n     * @private\n     * @return {Promise}\n     */\n    courseAjaxform.prototype.getcontentFooter = function() {\n        return Str.get_strings([{\n                key: 'cancel'\n            }]).then(function(s) {\n            var footer = '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+s[0]+'</button>';\n            return footer;\n        }.bind(this));\n    };\n    /**\n     * @param {object} args\n     * @method handleFormSubmissionResponse\n     * @private\n     * @return {Promise}\n     */\n    courseAjaxform.prototype.handleFormSubmissionResponse = function(args) {\n        this.modal.hide();\n        // We could trigger an event instead.\n        // Yuk.\n        Y.use('moodle-core-formchangechecker', function() {\n            M.core_formchangechecker.reset_form_dirty_state();\n        });\n\n        if (args.userid) {\n             this.modal.hide();\n        }else{\n            return Str.get_strings([{\n                key: 'courseoverview',\n                component: 'local_courses'\n            }]).then(function(s) {\n\n                // This will be the context for our template. So {{name}} in the template will resolve to \"Tweety bird\".\n                var context = { courseid: args.courseid, configpath: M.cfg.wwwroot,\n                     enrolid: args.enrolid, contextid:args.contextid};\n\n                var modalPromise = ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    body: Templates.render('local_courses/courses', context),\n                    footer: this.getcontentFooter(),\n                });\n                $.when(modalPromise).then(function(modal) {\n                    modal.setTitle(s[0]);\n\n                    // Forms are big, we want a big modal.\n                    modal.setLarge();\n\n                    modal.getRoot().addClass('openLMStransition');\n                    modal.show();\n                    modal.getRoot().animate({\"right\":\"0%\"}, 500);\n\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    }.bind(this));\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                        modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                        setTimeout(function(){\n                            window.location.reload();\n                        }, 600);\n                    });\n                    modal.getRoot().find('[data-action=\"hide\"]').on('click', function() {\n                        modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                        setTimeout(function(){\n                            window.location.reload();\n                        }, 200);\n                    });\n                    return modal;\n                }).fail(Notification.exception);\n                $('#coursesearch').dataTable().destroy();\n            }.bind(this));\n        }\n    };\n\n    /**\n     * @param {object} data\n     * @method handleFormSubmissionFailure\n     * @private\n     * @return {Promise}\n     */\n    courseAjaxform.prototype.handleFormSubmissionFailure = function(data) {\n        // Oh noes! Epic fail :(\n        // Ah wait - this is normal. We need to re-display the form with errors!\n        this.modal.setBody(this.getBody(data));\n    };\n\n    /**\n     * Private method\n     * @param {Event} e Form submission event.\n     * @param {int} args\n     * @method submitFormAjax\n     * @private\n     */\n    courseAjaxform.prototype.submitFormAjax = function(e, args) {\n        // We don't want to do a real form submission.\n        e.preventDefault();\n        var self = this;\n        // Convert all the form elements values to a serialised string.\n        var formData = this.modal.getRoot().find('form').serialize();\n\n        if (args.userid) {\n             var methodname = args.plugintype + '_' + args.pluginname + '_submit_evidence_course_form';\n        }else{\n            var methodname = args.plugintype + '_' + args.pluginname + '_submit_create_course_form';\n        }\n        // Now we can continue...\n        var params = {};\n        params.contextid = this.contextid;\n        params.jsonformdata = JSON.stringify(formData);\n        params.form_status = args.form_status;\n        var promise = Ajax.call([{\n            methodname: methodname,\n            args: params\n        }]);\n        promise[0].done(function(resp){\n            self.args.courseid = resp.courseid;\n            self.args.enrolid = resp.enrolid;\n            if(resp.form_status !== -1 && resp.form_status !== false) {\n                self.args.form_status = resp.form_status;\n                self.handleFormSubmissionFailure();\n            } else {\n                self.handleFormSubmissionResponse(self.args);\n            }\n        }).fail(function(){\n            self.handleFormSubmissionFailure(formData);\n        });\n\n    };\n\n    /**\n     * This triggers a form submission, so that any mform elements can do final tricks before the form submission is processed.\n     *\n     * @method submitForm\n     * @param {Event} e Form submission event.\n     * @private\n     */\n    courseAjaxform.prototype.submitForm = function(e) {\n        e.preventDefault();\n        this.modal.getRoot().find('form').submit();\n    };\n\n    return /** @alias module:core_group/courseAjaxform */ {\n        // Public variables and functions.\n        /**\n         * @param {int} args\n         * Attach event listeners to initialise this module.\n         *\n         * @method init\n         * @return {Promise}\n         */\n        init: function(args) {\n            return new courseAjaxform(args);\n        },\n        deleteConfirm: function(args){\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'deleteconfirm',\n                component: 'local_courses',\n                param : args\n            },\n            {\n                key: 'deleteallconfirm',\n                component: 'local_courses'\n            },\n            {\n                key: 'delete'\n            },\n            {\n                key: 'yesdelete',\n                component: 'local_courses'\n            },\n            {\n                key: 'no',\n                component: 'local_courses'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1],\n                    footer: '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+s[5]+'</button>&nbsp;' +\n            '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+s[4]+'</button>'\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\n                        args.confirm = true;\n                        var promise = Ajax.call([{\n                            methodname: 'local_courses_' + args.action,\n                            args: args\n                        }]);\n                        promise[0].done(function() {\n                            window.location.href = window.location.href + String();\n                        }).fail(function() {\n                            // do something with the exception.\n                        });\n                    }.bind(this));\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                        modal.setBody('');\n                        modal.hide();\n                    });\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        getCatlist: function() {\n            $('#id_open_costcenterid').on('change',function(){\n                return Str.get_strings([{\n                    key: 'selectdept',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'selectcat',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'selectlevel',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'select_certificate',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'errorinrequestprocessing',\n                    component: 'local_courses'\n                }]).then(function(s) {\n                    var orgID = $(this).val();\n                    if(orgID){\n                        var promise = Ajax.call([{\n                            methodname: 'local_courses_departmentlist',\n                            args: {\n                                orgid: orgID,\n                                depid: 0,\n                                flag: 0,\n                            },\n                        }]);\n                        promise[0].done(function(resp) {\n                           var template =  '<option value=null>'+s[0]+'</option>';\n                                $.each(JSON.parse(resp.departments), function( index, value) {\n                                    template += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_open_departmentid').html(template);\n                                var cattemplate = '<option value=\\'\\'>'+s[1]+'</option>';\n                                $.each(JSON.parse(resp.categories), function( index, value) {\n                                    cattemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_category').html(cattemplate);\n                                var leveltemplate =  '<option value=\\'\\'>'+s[2]+'</option>';\n                                $.each(JSON.parse(resp.levels), function( index, value) {\n                                    leveltemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_open_level').html(leveltemplate);\n\n                                var certtemplate =  '<option value=\\'\\'>'+s[3]+'</option>';\n                                $.each(JSON.parse(resp.certificates), function( index, value) {\n                                    certtemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_open_certificateid').html(certtemplate);\n                        }).fail(function() {\n                        });\n                    } else {\n                        var template = '<option value=\\'\\'>'+s[0]+'</option>';\n                        $('#id_open_departmentid').html(template);\n                        var cattemplate = '<option value=\\'\\'>'+s[1]+'</option>';\n                        $('#id_category').html(cattemplate);\n                        var leveltemplate = '<option value=\\'\\'>'+s[2]+'</option>';\n                        $('#id_open_level').html(leveltemplate);\n                        var certtemplate = '<option value=\\'\\'>'+s[3]+'</option>';\n                        $('#id_open_certificateid').html(certtemplate);\n                    }\n                }.bind(this));\n            });\n\n            $('#id_open_departmentid').on('change',function(){\n                return Str.get_strings([{\n                    key: 'selectcat',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'selectsubdept',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'errorinrequestprocessing',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'selectdept',\n                    component: 'local_courses'\n                }]).then(function(s) {\n                    var depID = $(this).val();\n                    if(depID && depID != 'null'){\n                        var promise = Ajax.call([{\n                            methodname: 'local_courses_departmentlist',\n                            args: {\n                                orgid: 0,\n                                depid: depID,\n                                flag: 1,\n                            },\n                        }]);\n                        promise[0].done(function(resp) {\n                           var cattemplate =  '<option value=\\'\\'>'+s[0]+'</option>';\n                                $.each(JSON.parse(resp.categories), function( index, value) {\n                                    cattemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_category').html(cattemplate);\n                        }).fail(function() {\n                        });\n                        var params = {};\n                        params.departmentid = depID;\n                        params.contextid = 1;\n                        var promise = Ajax.call([{\n                            methodname: 'local_users_get_subdepartments_list',\n                            args: params\n                        }]);\n                        promise[0].done(function(resp) {\n                            var resp = JSON.parse(resp);\n                            var template = '';\n                            $.each(resp, function(index,value) {\n                                template += '<option value = ' + index + ' >' +value + '</option>';\n                            });\n                            $(\"#id_open_subdepartment\").html(template);\n                        });\n                    } else {\n                        var empty_subdept_template = '<option>'+s[1]+'</option>';\n                        $(\"#id_open_subdepartment\").html(empty_subdept_template);\n                        var costcenter = $('#id_open_costcenterid').val();\n                        if (!costcenter)\n                            var costcenter = $('input[name=\"open_costcenterid\"]').val();\n                        if (costcenter) {\n                            var promise = Ajax.call([{\n                            methodname: 'local_courses_departmentlist',\n                            args: {\n                                orgid: costcenter,\n                                depid: 0,\n                                flag: 0,\n                            },\n                        }]);\n                        promise[0].done(function(resp) {\n                           var template = '<option value=null>'+s[3]+'</option>';\n                                $.each(JSON.parse(resp.departments), function( index, value) {\n                                    template += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_open_departmentid').html(template);\n                                var cattemplate = '<option value=\\'\\'>'+s[0]+'</option>';\n                                $.each(JSON.parse(resp.categories), function( index, value) {\n                                    cattemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_category').html(cattemplate);\n                        }).fail(function() {\n                        });\n                        }\n                     }\n                }.bind(this));\n            });\n            $('#id_open_subdepartment').on('change',function(){\n                return Str.get_strings([{\n                    key: 'selectcat',\n                    component: 'local_courses'\n                },\n                {\n                    key: 'errorinrequestprocessing',\n                    component: 'local_courses'\n                }]).then(function(s) {\n                    var subdepID = $(this).val();\n                    if (subdepID && subdepID != 0 && subdepID != 'null') {\n                        var promise = Ajax.call([{\n                            methodname: 'local_courses_departmentlist',\n                            args: {\n                                orgid: 0,\n                                depid: subdepID,\n                                flag: 1,\n                            },\n                        }]);\n                        promise[0].done(function(resp) {\n                           var cattemplate = '<option value=\\'\\'>'+s[0]+'</option>';\n                                $.each(JSON.parse(resp.categories), function( index, value) {\n                                    cattemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                });\n                                $('#id_category').html(cattemplate);\n                        }).fail(function() {\n\n                        });\n                    } else {\n                        var depID = $(\"#id_open_departmentid\").val();\n                        if (depID && depID != 'null') {\n                            var promise = Ajax.call([{\n                                methodname: 'local_courses_departmentlist',\n                                args: {\n                                    orgid: 0,\n                                    depid: depID,\n                                    flag: 1,\n                                },\n                            }]);\n                            promise[0].done(function(resp) {\n                               var cattemplate = '<option value=\\'\\'>'+s[0]+'</option>';\n                                    $.each(JSON.parse(resp.categories), function( index, value) {\n                                        cattemplate += '<option value = ' + index + ' >' +value + '</option>';\n                                    });\n                                    $('#id_category').html(cattemplate);\n                            }).fail(function() {\n\n                            });\n                        }\n                    }\n                }.bind(this));\n            });\n        },\n        coursenotdelete: function(args) {\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'cannotdelete',\n                component: 'local_courses',\n                param : args.name\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        coursenothide: function(args) {\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'cannothide',\n                component: 'local_courses',\n                param : args.name\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        load: function () {}\n    };\n});\n"],"names":["define","dataTable","$","Str","ModalFactory","ModalEvents","Fragment","Ajax","Y","Templates","courseAjaxform","args","contextid","init","prototype","modal","self","this","courseid","callback","head","key","component","param","coursename","userid","get_strings","then","strings","create","type","types","DEFAULT","title","body","getBody","footer","getFooter","bind","setLarge","getRoot","addClass","on","hidden","animate","setTimeout","destroy","setBody","find","window","location","href","M","cfg","wwwroot","sesskey","reload","submitForm","hide","form_status","form","submitFormAjax","show","formdata","jsonformdata","JSON","stringify","loadFragment","customstrings","viewtype","getcontentFooter","s","handleFormSubmissionResponse","use","core_formchangechecker","reset_form_dirty_state","context","configpath","enrolid","modalPromise","render","when","setTitle","fail","Notification","exception","handleFormSubmissionFailure","data","e","preventDefault","formData","serialize","methodname","plugintype","pluginname","params","call","done","resp","submit","deleteConfirm","confirm","action","String","getCatlist","orgID","val","orgid","depid","flag","template","each","parse","departments","index","value","html","cattemplate","categories","leveltemplate","levels","certtemplate","certificates","depID","departmentid","empty_subdept_template","costcenter","subdepID","coursenotdelete","name","coursenothide","load"],"mappings":";;;;;;;;AAQAA,sCAAO,CAAC,kCAAmC,SAAU,WACpD,qBAAsB,oBAAqB,gBAAiB,YAC3D,WAAY,mBACN,SAASC,UAAWC,EAAGC,IAAKC,aAAcC,YAAaC,SAAUC,KAAMC,EAAGC,eAS1EC,eAAiB,SAASC,WACrBC,UAAYD,KAAKC,WAAa,OAC9BD,KAAOA,UACPE,KAAKF,cAOdD,eAAeI,UAAUC,MAAQ,KAMjCL,eAAeI,UAAUF,WAAa,EAQtCF,eAAeI,UAAUD,KAAO,SAASF,UAEjCK,KAAOC,QACNN,KAAKO,YACc,+BAAhBP,KAAKQ,aACDC,KAAQ,CAACC,IAAK,qBAAqBC,UAAW,gBAAgBC,MAAOZ,KAAKa,oBAE1Eb,KAAKc,OACDL,KAAQ,CAACC,IAAI,sBAAuBC,UAAU,gBAAgBC,MAAOZ,KAAKa,iBAE1EJ,KAAQ,CAACC,IAAI,aAAcC,UAAU,sBAI9CF,KAAO,CAACC,IAAI,kBAAmBC,UAAU,wBAG5BnB,IAAIuB,YAAY,CAACN,KAAM,CACnCC,IAAK,MACLC,UAAW,eAEf,CACID,IAAK,KACLC,UAAW,eAEf,CACID,IAAK,kBACLC,UAAW,iBAEf,CACID,IAAK,SACLC,UAAW,YAEEK,KAAK,SAASC,gBAExBxB,aAAayB,OAAO,CACvBC,KAAM1B,aAAa2B,MAAMC,QACzBC,MAAOL,QAAQ,GACfM,KAAMjB,KAAKkB,UACXC,OAAQnB,KAAKoB,UAAUT,YAE7BU,KAAKrB,OAAOU,KAAK,SAASZ,mBAEnBA,MAAQA,MACO,8BAAhBJ,KAAKQ,gBAEAJ,MAAMwB,gBAENxB,MAAMyB,UAAUC,SAAS,wCAEzB1B,MAAMyB,UAAUE,GAAGrC,YAAYsC,OAAQ,gBACnC5B,MAAMyB,UAAUI,QAAQ,OAAS,QAAS,KAC/CC,YAAW,WACP9B,MAAM+B,YACP,UACE/B,MAAMgC,QAAQ,KACrBT,KAAKrB,QAOS,8BAAhBN,KAAKQ,eACAJ,MAAMsB,YAAYW,KAAK,wBAAwBN,GAAG,SAAS,WAC5DO,OAAOC,SAASC,KAAOC,EAAEC,IAAIC,QAC3B,iDACD3C,KAAKO,SAAS,YAAYkC,EAAEC,IAAIE,gBAGhCxC,MAAMsB,YAAYW,KAAK,0BAA0BN,GAAG,SAAS,WAC9DO,OAAOC,SAASM,iBAGfzC,MAAMyB,UAAUQ,KAAK,wBAAwBN,GAAG,SAAS,WAC1DO,OAAOC,SAASM,mBAGfzC,MAAMqB,OAAOY,KAAK,wBAAwBN,GAAG,QAASzB,KAAKwC,WAAWnB,KAAKrB,YAE3EF,MAAMsB,YAAYW,KAAK,0BAA0BN,GAAG,SAAS,WAC9D3B,MAAMgC,QAAQ,IACdhC,MAAM2C,OACNb,YAAW,WACP9B,MAAM+B,YACP,KACsB,IAArBnC,KAAKgD,aACLV,OAAOC,SAASM,iBAInBzC,MAAMyB,UAAUQ,KAAK,wBAAwBN,GAAG,SAAS,WAC1D3B,MAAM2C,OACNb,YAAW,WACP9B,MAAM+B,YACP,KACsB,IAArBnC,KAAKgD,aACLV,OAAOC,SAASM,kBAKvBzC,MAAMyB,UAAUE,GAAG,SAAU,QAAQ,SAASkB,MAC/C5C,KAAK6C,eAAeD,KAAM5C,KAAKL,cAE9BI,MAAM+C,YACN/C,MAAMyB,UAAUI,QAAQ,OAAS,MAAO,KACtC3B,KAAKF,OACduB,KAAKrB,QASXP,eAAeI,UAAUqB,QAAU,SAAS4B,sBAChB,IAAbA,WACPA,SAAW,SAGVpD,KAAKqD,aAAeC,KAAKC,UAAUH,UACjCzD,SAAS6D,aAAalD,KAAKN,KAAKW,UAAWL,KAAKN,KAAKQ,SAAUF,KAAKL,UAAWK,KAAKN,OAQ/FD,eAAeI,UAAUuB,UAAY,SAAS+B,mBAC9BhC,OAAS,SACY,+BAArBnB,KAAKN,KAAKQ,UACViB,QAAU,oEACTgC,cAAc,GAAG,kBAClBhC,QAAU,wEAAwEgC,cAAc,GAAG,aAE3E,YAApBnD,KAAKN,KAAK0D,WACdjC,QAAS,oEAAoEgC,cAAc,GAAG,kBAC9FhC,QAAU,wEAAwEgC,cAAc,GAAG,aAEpGhC,QAOf1B,eAAeI,UAAUwD,iBAAmB,kBACjCnE,IAAIuB,YAAY,CAAC,CAChBL,IAAK,YACLM,KAAK,SAAS4C,SACL,wEAAwEA,EAAE,GAAG,aAE5FjC,KAAKrB,QAQXP,eAAeI,UAAU0D,6BAA+B,SAAS7D,cACxDI,MAAM2C,OAGXlD,EAAEiE,IAAI,iCAAiC,WACnCrB,EAAEsB,uBAAuBC,6BAGzBhE,KAAKc,cAGEtB,IAAIuB,YAAY,CAAC,CACpBL,IAAK,iBACLC,UAAW,mBACXK,KAAK,SAAS4C,OAGVK,QAAU,CAAE1D,SAAUP,KAAKO,SAAU2D,WAAYzB,EAAEC,IAAIC,QACtDwB,QAASnE,KAAKmE,QAASlE,UAAUD,KAAKC,WAEvCmE,aAAe3E,aAAayB,OAAO,CACnCC,KAAM1B,aAAa2B,MAAMC,QACzBE,KAAMzB,UAAUuE,OAAO,wBAAyBJ,SAChDxC,OAAQnB,KAAKqD,qBAEjBpE,EAAE+E,KAAKF,cAAcpD,MAAK,SAASZ,cAC/BA,MAAMmE,SAASX,EAAE,IAGjBxD,MAAMwB,WAENxB,MAAMyB,UAAUC,SAAS,qBACzB1B,MAAM+C,OACN/C,MAAMyB,UAAUI,QAAQ,OAAS,MAAO,KAExC7B,MAAMyB,UAAUE,GAAGrC,YAAYsC,OAAQ,WACnC5B,MAAM+B,WACRR,KAAKrB,OACPF,MAAMsB,YAAYW,KAAK,0BAA0BN,GAAG,SAAS,WACzD3B,MAAMyB,UAAUI,QAAQ,OAAS,QAAS,KAC1CC,YAAW,WACPI,OAAOC,SAASM,WACjB,QAEPzC,MAAMyB,UAAUQ,KAAK,wBAAwBN,GAAG,SAAS,WACrD3B,MAAMyB,UAAUI,QAAQ,OAAS,QAAS,KAC1CC,YAAW,WACPI,OAAOC,SAASM,WACjB,QAEAzC,SACRoE,KAAKC,aAAaC,WACrBnF,EAAE,iBAAiBD,YAAY6C,WACjCR,KAAKrB,YA5CDF,MAAM2C,QAsDpBhD,eAAeI,UAAUwE,4BAA8B,SAASC,WAGvDxE,MAAMgC,QAAQ9B,KAAKkB,QAAQoD,QAUpC7E,eAAeI,UAAU+C,eAAiB,SAAS2B,EAAG7E,MAElD6E,EAAEC,qBACEzE,KAAOC,KAEPyE,SAAWzE,KAAKF,MAAMyB,UAAUQ,KAAK,QAAQ2C,eAE7ChF,KAAKc,WACAmE,WAAajF,KAAKkF,WAAa,IAAMlF,KAAKmF,WAAa,oCAExDF,WAAajF,KAAKkF,WAAa,IAAMlF,KAAKmF,WAAa,iCAG3DC,OAAS,GACbA,OAAOnF,UAAYK,KAAKL,UACxBmF,OAAO/B,aAAeC,KAAKC,UAAUwB,UACrCK,OAAOpC,YAAchD,KAAKgD,YACZpD,KAAKyF,KAAK,CAAC,CACrBJ,WAAYA,WACZjF,KAAMoF,UAEF,GAAGE,MAAK,SAASC,MACrBlF,KAAKL,KAAKO,SAAWgF,KAAKhF,SAC1BF,KAAKL,KAAKmE,QAAUoB,KAAKpB,SACA,IAAtBoB,KAAKvC,cAA2C,IAArBuC,KAAKvC,aAC/B3C,KAAKL,KAAKgD,YAAcuC,KAAKvC,YAC7B3C,KAAKsE,+BAELtE,KAAKwD,6BAA6BxD,KAAKL,SAE5CwE,MAAK,WACJnE,KAAKsE,4BAA4BI,cAYzChF,eAAeI,UAAU2C,WAAa,SAAS+B,GAC3CA,EAAEC,sBACG1E,MAAMyB,UAAUQ,KAAK,QAAQmD,UAGgB,CASlDtF,KAAM,SAASF,aACJ,IAAID,eAAeC,OAE9ByF,cAAe,SAASzF,aACbR,IAAIuB,YAAY,CAAC,CACpBL,IAAK,WAET,CACIA,IAAK,gBACLC,UAAW,gBACXC,MAAQZ,MAEZ,CACIU,IAAK,mBACLC,UAAW,iBAEf,CACID,IAAK,UAET,CACIA,IAAK,YACLC,UAAW,iBAEf,CACID,IAAK,KACLC,UAAW,mBACXK,KAAK,SAAS4C,GACdnE,aAAayB,OAAO,CAChBI,MAAOsC,EAAE,GACTzC,KAAM1B,aAAa2B,MAAMC,QACzBE,KAAMqC,EAAE,GACRnC,OAAQ,wEAAwEmC,EAAE,GAA1E,mFACoDA,EAAE,GAAG,cAClE0B,KAAK,SAASlF,YACRA,MAAQA,MACbA,MAAMyB,UAAUQ,KAAK,wBAAwBN,GAAG,QAAS,WACrD/B,KAAK0F,SAAU,EACD9F,KAAKyF,KAAK,CAAC,CACrBJ,WAAY,iBAAmBjF,KAAK2F,OACpC3F,KAAMA,QAEF,GAAGsF,MAAK,WACZhD,OAAOC,SAASC,KAAOF,OAAOC,SAASC,KAAOoD,YAC/CpB,MAAK,gBAGV7C,KAAKrB,OACPF,MAAMsB,YAAYW,KAAK,0BAA0BN,GAAG,SAAS,WACzD3B,MAAMgC,QAAQ,IACdhC,MAAM2C,UAEV3C,MAAM+C,QACRxB,KAAKrB,QACTqB,KAAKrB,QAEXuF,WAAY,WACRtG,EAAE,yBAAyBwC,GAAG,UAAS,kBAC5BvC,IAAIuB,YAAY,CAAC,CACpBL,IAAK,aACLC,UAAW,iBAEf,CACID,IAAK,YACLC,UAAW,iBAEf,CACID,IAAK,cACLC,UAAW,iBAEf,CACID,IAAK,qBACLC,UAAW,iBAEf,CACID,IAAK,2BACLC,UAAW,mBACXK,KAAK,SAAS4C,OACVkC,MAAQvG,EAAEe,MAAMyF,SACjBD,MAAM,CACSlG,KAAKyF,KAAK,CAAC,CACrBJ,WAAY,+BACZjF,KAAM,CACFgG,MAAOF,MACPG,MAAO,EACPC,KAAM,MAGN,GAAGZ,MAAK,SAASC,UAClBY,SAAY,sBAAsBvC,EAAE,GAAG,YACtCrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKe,cAAc,SAAUC,MAAOC,OAClDL,UAAY,mBAAqBI,MAAQ,KAAMC,MAAQ,eAE3DjH,EAAE,yBAAyBkH,KAAKN,cAC5BO,YAAc,oBAAsB9C,EAAE,GAAG,YAC7CrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKoB,aAAa,SAAUJ,MAAOC,OACjDE,aAAe,mBAAqBH,MAAQ,KAAMC,MAAQ,eAE9DjH,EAAE,gBAAgBkH,KAAKC,iBACnBE,cAAiB,oBAAsBhD,EAAE,GAAG,YAChDrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKsB,SAAS,SAAUN,MAAOC,OAC7CI,eAAiB,mBAAqBL,MAAQ,KAAMC,MAAQ,eAEhEjH,EAAE,kBAAkBkH,KAAKG,mBAErBE,aAAgB,oBAAsBlD,EAAE,GAAG,YAC/CrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKwB,eAAe,SAAUR,MAAOC,OACnDM,cAAgB,mBAAqBP,MAAQ,KAAMC,MAAQ,eAE/DjH,EAAE,0BAA0BkH,KAAKK,iBACtCtC,MAAK,mBAEL,KACC2B,SAAW,oBAAsBvC,EAAE,GAAG,YAC1CrE,EAAE,yBAAyBkH,KAAKN,cAC5BO,YAAc,oBAAsB9C,EAAE,GAAG,YAC7CrE,EAAE,gBAAgBkH,KAAKC,iBACnBE,cAAgB,oBAAsBhD,EAAE,GAAG,YAC/CrE,EAAE,kBAAkBkH,KAAKG,mBACrBE,aAAe,oBAAsBlD,EAAE,GAAG,YAC9CrE,EAAE,0BAA0BkH,KAAKK,gBAEvCnF,KAAKrB,UAGXf,EAAE,yBAAyBwC,GAAG,UAAS,kBAC5BvC,IAAIuB,YAAY,CAAC,CACpBL,IAAK,YACLC,UAAW,iBAEf,CACID,IAAK,gBACLC,UAAW,iBAEf,CACID,IAAK,2BACLC,UAAW,iBAEf,CACID,IAAK,aACLC,UAAW,mBACXK,KAAK,SAAS4C,OACVoD,MAAQzH,EAAEe,MAAMyF,SACjBiB,OAAkB,QAATA,MAAgB,CACVpH,KAAKyF,KAAK,CAAC,CACrBJ,WAAY,+BACZjF,KAAM,CACFgG,MAAO,EACPC,MAAOe,MACPd,KAAM,MAGN,GAAGZ,MAAK,SAASC,UAClBmB,YAAe,oBAAsB9C,EAAE,GAAG,YACzCrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKoB,aAAa,SAAUJ,MAAOC,OACjDE,aAAe,mBAAqBH,MAAQ,KAAMC,MAAQ,eAE9DjH,EAAE,gBAAgBkH,KAAKC,gBAC5BlC,MAAK,mBAEJY,OAAS,GACbA,OAAO6B,aAAeD,MACtB5B,OAAOnF,UAAY,EACLL,KAAKyF,KAAK,CAAC,CACrBJ,WAAY,sCACZjF,KAAMoF,UAEF,GAAGE,MAAK,SAASC,MACjBA,KAAOjC,KAAK+C,MAAMd,UAClBY,SAAW,GACf5G,EAAE6G,KAAKb,MAAM,SAASgB,MAAMC,OACxBL,UAAY,mBAAqBI,MAAQ,KAAMC,MAAQ,eAE3DjH,EAAE,0BAA0BkH,KAAKN,iBAElC,KACCe,uBAAyB,WAAWtD,EAAE,GAAG,eAC7CrE,EAAE,0BAA0BkH,KAAKS,0BAC7BC,WAAa5H,EAAE,yBAAyBwG,OAExC,IAAIoB,WAAa5H,EAAE,mCAAmCwG,SACtDoB,WACcvH,KAAKyF,KAAK,CAAC,CACzBJ,WAAY,+BACZjF,KAAM,CACFgG,MAAOmB,WACPlB,MAAO,EACPC,KAAM,MAGN,GAAGZ,MAAK,SAASC,UAClBY,SAAW,sBAAsBvC,EAAE,GAAG,YACrCrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKe,cAAc,SAAUC,MAAOC,OAClDL,UAAY,mBAAqBI,MAAQ,KAAMC,MAAQ,eAE3DjH,EAAE,yBAAyBkH,KAAKN,cAC5BO,YAAc,oBAAsB9C,EAAE,GAAG,YAC7CrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKoB,aAAa,SAAUJ,MAAOC,OACjDE,aAAe,mBAAqBH,MAAQ,KAAMC,MAAQ,eAE9DjH,EAAE,gBAAgBkH,KAAKC,gBAC5BlC,MAAK,iBAId7C,KAAKrB,UAEXf,EAAE,0BAA0BwC,GAAG,UAAS,kBAC7BvC,IAAIuB,YAAY,CAAC,CACpBL,IAAK,YACLC,UAAW,iBAEf,CACID,IAAK,2BACLC,UAAW,mBACXK,KAAK,SAAS4C,OACVwD,SAAW7H,EAAEe,MAAMyF,SACnBqB,UAAwB,GAAZA,UAA6B,QAAZA,SAAoB,CACnCxH,KAAKyF,KAAK,CAAC,CACrBJ,WAAY,+BACZjF,KAAM,CACFgG,MAAO,EACPC,MAAOmB,SACPlB,KAAM,MAGN,GAAGZ,MAAK,SAASC,UAClBmB,YAAc,oBAAsB9C,EAAE,GAAG,YACxCrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKoB,aAAa,SAAUJ,MAAOC,OACjDE,aAAe,mBAAqBH,MAAQ,KAAMC,MAAQ,eAE9DjH,EAAE,gBAAgBkH,KAAKC,gBAC5BlC,MAAK,mBAGL,KACCwC,MAAQzH,EAAE,yBAAyBwG,SACnCiB,OAAkB,QAATA,MACKpH,KAAKyF,KAAK,CAAC,CACrBJ,WAAY,+BACZjF,KAAM,CACFgG,MAAO,EACPC,MAAOe,MACPd,KAAM,MAGN,GAAGZ,MAAK,SAASC,UAClBmB,YAAc,oBAAsB9C,EAAE,GAAG,YACxCrE,EAAE6G,KAAK9C,KAAK+C,MAAMd,KAAKoB,aAAa,SAAUJ,MAAOC,OACjDE,aAAe,mBAAqBH,MAAQ,KAAMC,MAAQ,eAE9DjH,EAAE,gBAAgBkH,KAAKC,gBAC5BlC,MAAK,iBAKlB7C,KAAKrB,WAGf+G,gBAAiB,SAASrH,aACfR,IAAIuB,YAAY,CAAC,CACpBL,IAAK,WAET,CACIA,IAAK,eACLC,UAAW,gBACXC,MAAQZ,KAAKsH,QACbtG,KAAK,SAAS4C,GACdnE,aAAayB,OAAO,CAChBI,MAAOsC,EAAE,GACTzC,KAAM1B,aAAa2B,MAAMC,QACzBE,KAAMqC,EAAE,KACT0B,KAAK,SAASlF,YACRA,MAAQA,MACbA,MAAM+C,QACRxB,KAAKrB,QACTqB,KAAKrB,QAEXiH,cAAe,SAASvH,aACbR,IAAIuB,YAAY,CAAC,CACpBL,IAAK,WAET,CACIA,IAAK,aACLC,UAAW,gBACXC,MAAQZ,KAAKsH,QACbtG,KAAK,SAAS4C,GACdnE,aAAayB,OAAO,CAChBI,MAAOsC,EAAE,GACTzC,KAAM1B,aAAa2B,MAAMC,QACzBE,KAAMqC,EAAE,KACT0B,KAAK,SAASlF,YACRA,MAAQA,MACbA,MAAM+C,QACRxB,KAAKrB,QACTqB,KAAKrB,QAEXkH,KAAM"}