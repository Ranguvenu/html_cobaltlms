/**
 * Add a create new group modal to the page.
 *
 * @module     core_group/AjaxForms
 * @class      AjaxForms
 * @package
 * @copyright  2022 eAbyas Info Solutions
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_timetable/ajaxforms",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates"],(function($,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y,Templates){var AjaxForms=function(args){this.contextid=args.contextid,this.args=args,this.init(args)};return AjaxForms.prototype.modal=null,AjaxForms.prototype.contextid=-1,AjaxForms.prototype.init=function(args){var header_label,self=this;switch(args.callback){case"session_form":case"update_session":switch(args.action){case 1:header_label={key:"addsession",component:"local_timetable"};break;case 2:header_label={key:"updatesession",component:"local_timetable"}}}return Str.get_strings([header_label,{key:"savecontinue",component:"local_timetable"},{key:"previous",component:"local_timetable"},{key:"cancel",component:"local_timetable"},{key:"save",component:"local_timetable"}]).then(function(strings){return ModalFactory.create({type:ModalFactory.types.DEFAULT,title:strings[0],body:this.getBody(),footer:this.getFooter(strings)})}.bind(this)).then(function(modal){return this.modal=modal,this.modal.setLarge(),this.modal.getRoot().addClass("openLMStransition local_timetable"),this.modal.getRoot().on(ModalEvents.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500),setTimeout((function(){modal.destroy()}),1e3)}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.destroy(),window.location.href=window.location.href+String()})),this.modal.getFooter().find('[data-action="previous"]').on("click",(function(){self.args.form_status=self.args.form_status-1;var data=self.getBody();data.then((function(html){!1===html&&window.location.reload()})),modal.setBody(data),0==self.args.form_status?$('[data-action="previous"]').css("display","none"):$('[data-action="previous"]').css("display","block")})),this.modal.getRoot().on("submit","form",(function(form){self.submitFormAjax(form,self.args)})),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),$(".close").click((function(){window.location.href=window.location.href+String()})),this.modal}.bind(this))},AjaxForms.prototype.getBody=function(formdata){return void 0===formdata&&(formdata={}),this.args.jsonformdata=JSON.stringify(formdata),Fragment.loadFragment(this.args.component,this.args.callback,this.contextid,this.args)},AjaxForms.prototype.getFooter=function(strings){var footer;return footer='<button type="button" class="btn btn-primary" data-action="save">'+strings[4]+"</button>&nbsp;",'style="display:none;"',footer+='<button type="button" class="btn btn-secondary" data-action="previous" style="display:none;" >'+strings[2]+"</button>&nbsp;",footer+='<button type="button" class="btn btn-secondary" data-action="cancel">'+strings[3]+"</button>"},AjaxForms.prototype.handleFormSubmissionResponse=function(args){this.modal.destroy(),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),window.location.reload()},AjaxForms.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))},AjaxForms.prototype.submitFormAjax=function(e,args){e.preventDefault();var self=this,formData=this.modal.getRoot().find("form").serialize();this.modal.getRoot().find("form").serializeArray();if("update_session"===args.callback)var method="local_timetable_update_instance";if("session_form"===args.callback)method="local_timetable_submit_instance";var methodname=method,params={};"update_session"===args.callback&&(params.id=args.id),"session_form"===args.callback&&args.id>0&&(params.id=args.id),params.contextid=this.contextid,params.jsonformdata=JSON.stringify(formData),params.form_status=args.form_status,params.dayname=args.dayname,params.semesterid=args.semesterid,params.slotid=args.slotid,Ajax.call([{methodname:methodname,args:params}])[0].done((function(resp){null==resp.form_status&&(self.args.id=resp.id,self.handleFormSubmissionResponse(self.args)),-1!==resp.form_status&&!1!==resp.form_status?(self.args.form_status=resp.form_status,self.args.id=resp.id,self.handleFormSubmissionFailure(self.args)):(self.args.id=resp.id,self.handleFormSubmissionResponse(self.args))})).fail((function(){self.handleFormSubmissionFailure(formData)}))},AjaxForms.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(args){return new AjaxForms(args)},sessdeleteconfirm:function(args){return Str.get_strings([{key:"confirm",component:"local_timetable"},{key:"deleteconfirm",component:"local_timetable",param:args.sessionname},{key:"yes",component:"local_timetable"},{key:"no",component:"local_timetable"},{key:"delete"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.DEFAULT,body:s[1],footer:'<button type="button" class="btn btn-primary" data-action="save">'+s[2]+'</button>&nbsp;<button type="button" class="btn btn-secondary" data-action="cancel">'+s[3]+"</button>"}).done(function(modal){this.modal=modal,modal.getRoot().find('[data-action="save"]').on("click",function(){args.confirm=!0;var data={};data.id=args.id,Ajax.call([{methodname:"local_timetable_delete_instance",args:data}])[0].done((function(){window.location.reload(),window.location.href=window.location.href})).fail((function(ex){}))}.bind(this)),modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.setBody(""),modal.destroy()})),modal.show()}.bind(this))}.bind(this))},semslotdeleteconfirm:function(args){return Str.get_strings([{key:"confirm",component:"local_timetable"},{key:"deleteconfirmslots",component:"local_timetable",param:args.levelname},{key:"yes",component:"local_timetable"},{key:"no",component:"local_timetable"},{key:"delete"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.DEFAULT,body:s[1],footer:'<button type="button" class="btn btn-primary" data-action="save">'+s[2]+'</button>&nbsp;<button type="button" class="btn btn-secondary" data-action="cancel">'+s[3]+"</button>"}).done(function(modal){this.modal=modal,modal.getRoot().find('[data-action="save"]').on("click",function(){args.confirm=!0;var data={};data.id=args.id,Ajax.call([{methodname:"local_timetable_semester_slots_delete_instance",args:data}])[0].done((function(){window.location.reload(),window.location.href=window.location.href})).fail((function(ex){}))}.bind(this)),modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.setBody(""),modal.destroy()})),modal.show()}.bind(this))}.bind(this))},deletesessionConfirm:function(args){return Str.get_strings([{key:"confirm"},{key:"delete_session",component:"local_timetable",param:args.name},{key:"yes",component:"local_timetable"},{key:"no",component:"local_timetable"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.DEFAULT,body:s[1],footer:'<button type="button" class="btn btn-primary" data-action="save">'+s[2]+'</button>&nbsp;<button type="button" class="btn btn-secondary" data-action="cancel">'+s[3]+"</button>"}).done(function(modal){this.modal=modal,modal.getRoot().find('[data-action="save"]').on("click",function(){args.confirm=!0;var params={};params.id=args.id,params.contextid=args.contextid,Ajax.call([{methodname:"local_timetable_"+args.action,args:params}])[0].done((function(){window.location.href=window.location.href+String()})).fail((function(){}))}.bind(this)),modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.setBody(""),modal.destroy()})),modal.show()}.bind(this))}.bind(this))},deletesessiontype:function(args){return Str.get_strings([{key:"confirm"},{key:"delete_session_type",component:"local_timetable",param:args.name},{key:"yes",component:"local_timetable"},{key:"no",component:"local_timetable"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.DEFAULT,body:s[1],footer:'<button type="button" class="btn btn-primary" data-action="save">'+s[2]+'</button>&nbsp;<button type="button" class="btn btn-secondary" data-action="cancel">'+s[3]+"</button>"}).done(function(modal){this.modal=modal,modal.getRoot().find('[data-action="save"]').on("click",function(){args.confirm=!0;var params={};params.id=args.id,params.contextid=args.contextid,Ajax.call([{methodname:"local_timetable_"+args.action,args:params}])[0].done((function(){window.location.href=window.location.href+String()})).fail((function(){}))}.bind(this)),modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.setBody(""),modal.destroy()})),modal.show()}.bind(this))}.bind(this))},sessiontype_notdelete:function(args){if("edit"==args.type)var skey="session_type_not_edit";else skey="session_type_not_delete";return Str.get_strings([{key:"confirm"},{key:skey,component:"local_timetable",param:args.name}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.DEFAULT,body:s[1]}).done(function(modal){this.modal=modal,modal.show()}.bind(this))}.bind(this))},load:function(){}}}));

//# sourceMappingURL=ajaxforms.min.js.map