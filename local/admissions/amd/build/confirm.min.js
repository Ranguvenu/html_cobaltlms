/**
 * Add a create new group modal to the page.
 *
 * @module     local_admissions/confirm
 * @class      confirm
 * @package
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_admissions/confirm",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],(function($,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y){var confirm=function(args){this.contextid=args.context,this.id=args.id;this.args=args,this.init(args)};return confirm.prototype.modal=null,confirm.prototype.contextid=-1,confirm.prototype.init=function(){var self=this;if(self.id)var strings=Str.get_strings([{key:"cancel",component:"local_admissions"},{key:"save_continue",component:"local_admissions"},{key:"reviseapplication",component:"local_admissions"},{key:"previous",component:"local_admissions"},{key:"cancel",component:"local_admissions"}]);else strings=Str.get_strings([{key:"cancel",component:"local_admissions"},{key:"save_continue",component:"local_admissions"},{key:"reviseapplication",component:"local_admissions"},{key:"previous",component:"local_admissions"},{key:"cancel",component:"local_admissions"}]);return strings.then(function(strings){return ModalFactory.create({type:ModalFactory.types.DEFAULT,title:strings[2],body:this.getBody(),footer:this.getFooter(strings)})}.bind(this)).then(function(modal){return this.modal=modal,this.modal.setLarge(!1),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.hide(),setTimeout((function(){modal.destroy()}),500),window.location.reload()})),this.modal.getRoot().on("submit","form",(function(form){self.submitFormAjax(form,self.args)})),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),this.modal}.bind(this))},confirm.prototype.getBody=function(formdata){return void 0===formdata&&(formdata={}),this.args.jsonformdata=JSON.stringify(formdata),Fragment.loadFragment("local_admissions","new_statusconfirmform",this.contextid,this.args)},confirm.prototype.getFooter=function(strings){var $footer;return $footer='<button type="button" class="btn btn-secondary" data-action="cancel">'+strings[0]+"</button>",'style="display:none;"',$footer+='<button id="id_revise" type="button" class="btn btn-primary before_revise" data-action="save">'+strings[1]+"</button>&nbsp;"},confirm.prototype.handleFormSubmissionResponse=function(){this.modal.destroy(),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),window.location.reload()},confirm.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))},confirm.prototype.submitFormAjax=function(e,args){e.preventDefault();var self=this,formData=this.modal.getRoot().find("form").serialize(),params={};if(params.contextid=args.context,params.admissionid=args.admissionid,params.programid=args.programid,params.jsonformdata=JSON.stringify(formData),0!==document.getElementById("id_reason").value.length){$(document).on("click","#id_revise",(function(){$(this).removeClass("before_revise").addClass("not-allowed")}));let footer=Y.one(".modal-footer");M.util.add_spinner(Y,footer).show()}Ajax.call([{methodname:"local_admissions_status_statusconfirmform",args:params}])[0].done((function(resp){self.handleFormSubmissionResponse(),resp?(self.args.admissionid=resp.admissionid,self.args.programid=resp.programid,self.handleFormSubmissionFailure()):(self.modal.destroy(),window.location.reload())})).fail((function(){self.handleFormSubmissionFailure(formData)}))},confirm.prototype.submitForm=function(e){e.preventDefault();this.modal.getRoot().find("form").submit()},{init:function(args){return new confirm(args)},load:function(){}}}));

//# sourceMappingURL=confirm.min.js.map